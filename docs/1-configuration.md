# Configuration

Papyrus Docs is configured through a single file: `config/papyrus.php`.

## Artisan Install Command

The fastest way to set up Papyrus:

```bash
php artisan papyrus:install
```

This single command publishes both the config file (`papyrus-config` tag) and production assets (`papyrus-assets` tag).

Or publish individually:

```bash
# Config only
php artisan vendor:publish --tag=papyrus-config

# Assets only
php artisan vendor:publish --tag=papyrus-assets
```

---

## General Settings

### `title`

The title shown in the Papyrus sidebar header and browser tab.

```php
'title' => 'My API Docs',
```

### `enabled`

Master switch. When `false`, all Papyrus routes return 404.

```php
'enabled' => env('PAPYRUS_ENABLED', true),
```

> **Tip:** Set `PAPYRUS_ENABLED=false` in your production `.env` to completely disable Papyrus.

### `debug`

When `true`, the schema API response includes X-Debug headers with timing and memory usage.

```php
'debug' => env('PAPYRUS_DEBUG', false),
```

### `url`

The base URL path for all Papyrus routes.

```php
'url' => 'papyrus-docs',  // → http://your-app.test/papyrus-docs
```

All Papyrus routes (UI, API, assets, favicons) are prefixed with this path.

### `middlewares`

Middleware applied to all Papyrus routes.

```php
'middlewares' => ['web'],
```

To protect access in production:

```php
'middlewares' => ['web', 'auth', 'can:viewPapyrusDocs'],
```

---

## Route Filtering

### `only_route_uri_start_with`

Only include routes whose URI begins with this prefix.

```php
'only_route_uri_start_with' => 'api/',  // Only document API routes
```

Leave empty (`''`) to include all routes.

### `hide_matching`

Array of regex patterns. Matching routes are excluded from documentation.

```php
'hide_matching' => [
    '#^telescope#',       // Hide Laravel Telescope
    '#^docs#',            // Hide old docs routes
    '#^sanctum#',         // Hide Sanctum routes
    '#^_ignition#',       // Hide Ignition
    '#^papyrus-docs#',    // Hide Papyrus itself
],
```

Each pattern uses `preg_match` — patterns **must include delimiters** (e.g., `#...#`).

---

## Validation Parsing

### `rules_methods`

The method name(s) Papyrus calls on your `FormRequest` classes to extract rules.

```php
'rules_methods' => ['rules'],
```

If your FormRequests use non-standard method names (e.g., for create/update separation):

```php
'rules_methods' => ['rules', 'createRules', 'updateRules'],
```

Papyrus will call each method and merge the results.

---

## Playground Defaults

### `default_responses`

HTTP status codes displayed as reference badges in the Playground response section.

```php
'default_responses' => [
    '200', '400', '401', '403', '404', '405', '422', '429', '500', '503',
],
```

### `default_headers`

Headers pre-populated in the Playground's headers editor on every endpoint.

```php
'default_headers' => [
    'Content-Type'    => 'application/json',
    'Accept'          => 'application/json',
    'Accept-Language' => 'en',
    'Authorization'   => 'Bearer ',
],
```

> **Note:** When the payload contains files, Papyrus automatically strips the `Content-Type` header to let the browser set the correct `multipart/form-data` boundary.

Users can override, disable, or add new headers at runtime using the Playground's headers editor.

---

## Route Grouping

### `group_by.uri_patterns`

Config-driven regex patterns for grouping routes in the sidebar.

```php
'group_by' => [
    'uri_patterns' => [
        '^api/v[\\d]+/',   // Groups versioned API routes (api/v1/, api/v2/)
        '^api/',            // Groups all other API routes
    ],
],
```

Routes are matched against each pattern in order. The first match determines the group. Unmatched routes fall into "Other".

> In the UI, users can also switch grouping mode to `API Name`, `Controller Name`, or `URI Patterns` via the Settings modal.

---

## OpenAPI Export

### `open_api.title` / `open_api.description`

Metadata for the generated OpenAPI specification.

```php
'open_api' => [
    'title'       => 'My API Documentation',
    'description' => 'Auto-generated by Papyrus Docs.',
],
```

### `open_api.version`

The OpenAPI spec version to target.

```php
'version' => '3.0.0',   // or '3.1.0'
```

### `open_api.document_version`

Your API's version number.

```php
'document_version' => '1.0.0',
```

### `open_api.server_url`

The base server URL for the spec.

```php
'server_url' => env('APP_URL', 'http://localhost'),
```

### `open_api.license`

The license name for the API documentation.

```php
'license' => 'Apache 2.0',
```

### `open_api.delete_with_body`

Whether DELETE requests include a request body in the spec.

```php
'delete_with_body' => false,
```

### `open_api.exclude_http_methods`

HTTP methods to exclude from the export.

```php
'exclude_http_methods' => ['HEAD', 'OPTIONS'],
```

### `open_api.responses`

Predefined response descriptions for common status codes.

```php
'responses' => [
    '200' => ['description' => 'OK'],
    '401' => ['description' => 'Unauthorized'],
    '422' => ['description' => 'Validation Error'],
],
```

### `open_api.security`

The default security scheme for the spec.

```php
'security' => [
    'type'     => 'bearer',     // bearer, apiKey, basic, oauth2
    'name'     => 'api_key',
    'position' => 'header',     // header, query, cookie
],
```

### `export_path`

Where the exported OpenAPI JSON file will be written.

```php
'export_path' => 'api.json',
```

---

## Authorization

Papyrus registers a `viewPapyrusDocs` gate that controls access to the UI.

### Default Behavior

By default, Papyrus is accessible only in `local` and `testing` environments:

```php
// Registered automatically by PapyrusServiceProvider
Gate::define('viewPapyrusDocs', function ($user = null) {
    return app()->environment('local', 'testing');
});
```

### Customizing Access

Override the gate in your `AuthServiceProvider`:

```php
Gate::define('viewPapyrusDocs', function ($user = null) {
    return $user && $user->hasRole('admin');
});
```

The gate is applied to the main UI route (`GET /papyrus-docs`). The schema API (`/papyrus-docs/api/schema`) does not use the gate by default — add middleware if you need to protect it.

---

## Internal Routes

Papyrus registers these routes automatically:

| Route | Method | Purpose | Protection |
|---|---|---|---|
| `/{url}` | GET | Main SPA UI | `viewPapyrusDocs` gate |
| `/{url}/api/schema` | GET | JSON schema API | Middleware only |
| `/{url}/assets/{path}` | GET | JS, CSS, fonts | None |
| `/{url}/favicon/{file?}` | GET | Favicons | None |

All routes are prefixed with the `url` config value (default: `papyrus-docs`) and wrapped in the `middlewares` config.

Asset routes include path traversal protection (`..` is stripped) and return files with 1-year cache headers.

---

## Debug Mode

Enable debug mode for development diagnostics:

```env
PAPYRUS_DEBUG=true
```

The schema API (`/api/schema`) will include these response headers:

| Header | Example | Description |
|---|---|---|
| `X-Papyrus-Debug-Time-Ms` | `12.34` | Schema generation time |
| `X-Papyrus-Debug-Memory-Mb` | `2.50` | Memory consumed |
| `X-Papyrus-Debug-PHP` | `8.3.0` | PHP version |
| `X-Papyrus-Debug-Laravel` | `11.0.0` | Laravel version |

> Always disable debug mode in production.
